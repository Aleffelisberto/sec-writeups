# Text4Shell (CVE-2022-42889)

The vulnerability affects Java systems that make use of a specfic functionality of [Apache Commons Text](https://commons.apache.org/proper/commons-text/), what is a library used for processing strings focused on algorithms for managing data.

It was disclosed on October 2022, which allow remote attackers to execute arbitrary code on the server.

### Vulnerable apps:

- Using Apache Commons 1.5 to 1.9

## Exploitation requirements:

- The application accepts user-controlled input that is processed by one of the following methods:
  - StringLookupFactory.INSTANCE.interpolatorStringLookup().lookup()
  - StringSubstitutor.createInterpolator().replace()
- Java V >= 15 wouldn't be susceptible to remote code execution, since the Nashborn engine is disabled and the "script" prefix wouldn't be available. However, other attacks via the "url" and "dns" prefixes would be possible.

## Example of code vulnerable to Text4Shell

```java
String poc1 = “${script:javascript:java.lang.Runtime.getRuntime().exec(\”touch /tmp/foo\”);}”;
String rce1 = StringSubstitutor.createInterpolator().replace(poc1);

String poc2 = “script:javascript:java.lang.Runtime.getRuntime().exec(\”touch /tmp/foo\”)”;
String rce2 = StringLookupFactory.INSTANCE.interpolatorStringLookup().lookup(poc2);
```

### References

- [karthikuj PoC](https://github.com/karthikuj/cve-2022-42889-text4shell-docker.git)
- [CVE-2022-42889 MITRE](https://github.com/karthikuj/cve-2022-42889-text4shell-docker.git)
- [Tarlic article](https://www.tarlogic.com/blog/cve-2022-42889-text4shell-vulnerability/#CVE-2022-42889_Key_Features)
